<script src="jquery-3.7.1.min.js"></script>
<style>
#contenu {
	border:1px solid black;
	padding:5px;
}

#contenu textarea{
	display:block;
	width:100%;
	margin:3px 0;
}

#contenu p:hover{
	cursor:pointer;
	border:1px dashed black;
}

.m5 {
	margin:5px 0;
}
</style>
<script>


var jAjoutP = 
	$("<div>")
		.addClass("m5")
		.append( // btn + 
			$("<input type='button'>")
				.val("+")
				.click(function(){
					// référence jQ. sur l'elt cible de l'evt => $(this) 
					// var isFirst = $("input[value='+']").first().is($(this));
					var isFirst = $("input[value='+']:first").is($(this));
					var contenu = $(this).next().val(); 
					var jCloneP = jPEditable.clone(true);
					if (contenu != "") 
						jCloneP.html(contenu); 
					
					if (isFirst) {
						$("#contenu").prepend(jCloneP); 
					} else {
						$("#contenu").append(jCloneP); 
					}
				
				}) // fin fn click btn + 
		) // fin append btn+
		.append( // champ texte 
			$("<input type='text'>")
		); 
		// fin composant ajoutP
 

// TODO : Lors de l'appui sur Escape 
// dans le document 
// parcourir les TA => $("..").each(foo) => page 68 
// les remplacer par des P. en reprenant leur contenu initial 

// afficher les méta-données s'il y en a 
$(document).on("mouseover","#contenu *", function(){
	var meta = $(this).data(); 
	if (! $.isEmptyObject(meta)) console.log(meta); 
}); 

// Pour attendre le chargement de la page 
$(document).ready(function(){

	// à insérer avant et après le contenu
	$("#contenu").before(jAjoutP.clone(true));
	$("#contenu").after(jAjoutP.clone(true));

}); 


var jPEditable = $("<p>")
	.html("nouveau")
	.click(function(){
		// récupérer contenu actuel du P. => .html()
		var contenu=$(this).html(); 
		// créer un TA avec le même contenu => composant !
		var jTAClone = jTAValidable
			.clone(true)
			.val(contenu)
			.data({initValue: contenu, cle2:"val2"});
			//.data("initValue",contenu); 
			 
		// remplacer le P. par ce TA => .replaceWith()
		$(this).replaceWith(jTAClone); 

	}); // fin jPEditable
	
var jTAValidable = $("<textarea>")
	.keydown(function(contexte){
		// SI (ENTREE vient d'être appuyée)
		if (contexte.key == "Enter") {
			// récupérer le contenu actuel du TA
			var contenu = $(this).val();
			// Créer un P éditable avec ce même contenu  
			var jPClone = jPEditable
				.clone(true)
				.html(contenu); 
				
			// remplacer le TA par ce P
			$(this).replaceWith(jPClone);
		}
	}); // fin jTAValidable 

	
// Composant TAValidable
// un TA 
// sensible à keydown 
// lorsque ENTREE est appuyée, il se transforme en PEditable



</script>

<body>

	<div id="contenu">

	</div>

	
</body>


